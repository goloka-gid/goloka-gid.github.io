<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ú–∏—Ä –≠–ª–ª–∏</title>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&family=Lora:ital,wght@0,400;1,500&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #fdfbf7 0%, #e8e3f5 100%);
            --accent: #9b87f5;
            --text-color: #4a4a6a;
        }

        body {
            font-family: 'Comfortaa', cursive;
            background: var(--bg-gradient);
            background-attachment: fixed;
            color: var(--text-color);
            margin: 0; padding: 20px;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* –ì–ª–∞–≤–Ω–∞—è —Å–µ—Ç–∫–∞ */
        #main-view { display: block; }
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; max-width: 500px; margin: 0 auto; padding-bottom: 50px; }
        
        .day-card {
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(10px);
            border-radius: 20px; padding: 15px 5px; text-align: center;
            box-shadow: 0 8px 20px rgba(155, 135, 245, 0.15);
            border: 1px solid white; transition: 0.2s;
        }
        .day-card:active { transform: scale(0.95); }
        .day-icon { font-size: 30px; margin: 5px 0; }
        .day-name { font-size: 10px; font-weight: bold; }

        /* –°—Ç—Ä–∞–Ω–∏—Ü–∞ —á—Ç–µ–Ω–∏—è */
        #content-page {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-gradient); z-index: 1000;
        }

        /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∞–ø–∫–∞ */
        .header-fixed {
            position: absolute; top: 0; left: 0; width: 100%; height: 70px;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px; box-sizing: border-box;
            background: rgba(253, 251, 247, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1100;
            border-bottom: 1px solid rgba(155, 135, 245, 0.1);
        }

        .scroll-wrapper {
            position: relative; height: 100%; padding-top: 70px;
            mask-image: linear-gradient(to bottom, transparent, black 15%, black 85%, transparent);
            -webkit-mask-image: linear-gradient(to bottom, transparent, black 15%, black 85%, transparent);
        }

        .scroll-container {
            height: 100%; overflow-y: auto; scroll-behavior: smooth;
            padding: 20px 20px 250px 20px; box-sizing: border-box;
        }

        .magic-scroll-btn {
            background: white; border: none; padding: 10px 18px;
            border-radius: 50px; color: var(--accent); font-weight: bold;
            box-shadow: 0 4px 15px rgba(155, 135, 245, 0.3);
            font-family: 'Comfortaa'; cursor: pointer; font-size: 13px;
        }
        .magic-scroll-btn.active { background: var(--accent); color: white; }

        .magic-text {
            font-family: 'Lora', serif;
            font-size: 19px; line-height: 1.8; color: #3a2b5d;
            text-shadow: 0.5px 0.5px 0px rgba(255,255,255,0.8), 1px 1px 2px rgba(155,135,245,0.1);
            white-space: pre-wrap; margin: 20px 0;
        }

        .section-box {
            background: rgba(255,255,255,0.4);
            border-radius: 25px; padding: 20px; margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.6);
        }

        .back-btn { background: white; border: none; width: 40px; height: 40px; border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.05); font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        /* –°—Ç–∏–ª—å –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–π */
        .book-illustration {
            width: 100%; max-width: 400px; display: block;
            margin: 30px auto; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 6px solid white;
        }
    </style>
</head>
<body>

    <div id="main-view">
        <h1 style="text-align: center; color: #7c67d6;">‚ú® –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≠–ª–ª–∏</h1>
        <div class="grid" id="main-grid"></div>
    </div>

    <div id="content-page">
        <div class="header-fixed">
            <button class="back-btn" onclick="closeDay()">üîô</button>
            <button class="magic-scroll-btn" id="scroll-btn" onclick="toggleAutoScroll()">‚ú® –ù–∞—á–∞—Ç—å —á—Ç–µ–Ω–∏–µ</button>
        </div>

        <div class="scroll-wrapper">
            <div class="scroll-container" id="scroll-box">
                <h2 id="title-label" style="text-align: center; color: var(--accent); margin-bottom: 30px;"></h2>

                <div class="section-box">
                    <div id="story-display" class="magic-text"></div>
                </div>

                <div class="section-box">
                    <h3 style="color: var(--accent); margin-top:0; font-size: 16px;">üéµ –°–ª—É—à–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é</h3>
                    <audio id="audio-player" controls style="width: 100%;"></audio>
                </div>
                
                <div class="section-box">
                    <h3 style="color: var(--accent); margin-top:0; font-size: 16px;">üßò –ü—Ä–∞–∫—Ç–∏–∫–∞ –¥–Ω—è</h3>
                    <div id="practice-display" class="magic-text" style="font-size: 16px;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const items = [
            {n: "–í–æ–ª—à–µ–±–Ω–∞—è –ö–∏—Å—Ç—å", i: "üñåÔ∏è"}, {n: "–ó–µ—Ä–∫–∞–ª–æ –ú–µ—á—Ç—ã", i: "ü™û"}, {n: "–ö–æ–º–ø–∞—Å –ù–∞–º–µ—Ä–µ–Ω–∏–π", i: "üß≠"},
            {n: "–°—É–Ω–¥—É–∫ –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–µ–π", i: "üì¶"}, {n: "–ê–º—É–ª–µ—Ç –°–∏–ª—ã", i: "üßø"}, {n: "–í–æ–ª—à–µ–±–Ω—ã–π –ü–æ—è—Å", i: "üéóÔ∏è"},
            {n: "–©–∏—Ç –ù–∞—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏", i: "üõ°Ô∏è"}, {n: "–ú–æ—Å—Ç –†–∞–¥–æ—Å—Ç–∏", i: "üåà"}, {n: "–õ–æ–≤–µ—Ü –ú—ã—Å–ª–µ–π", i: "üï∏Ô∏è"},
            {n: "–í–æ–ª—à–µ–±–Ω–∞—è –ö–Ω–æ–ø–∫–∞", i: "üîò"}, {n: "–†—é–∫–∑–∞–∫ –ü–æ–¥–¥–µ—Ä–∂–∫–∏", i: "üéí"}, {n: "–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –°–∞–¥", i: "üå≥"},
            {n: "–°–≤–µ—Ç–æ—Ñ–æ—Ä –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏—è", i: "üö•"}, {n: "–î–æ–º–∏–∫ –°–ø–æ–∫–æ–π—Å—Ç–≤–∏—è", i: "üè†"}, {n: "–í–æ–ª—à–µ–±–Ω—ã–π –®–∞–≥", i: "üë£"},
            {n: "–í–æ–ª—à–µ–±–Ω—ã–µ –û—á–∫–∏", i: "üëì"}, {n: "–û–¥–µ—è–ª–æ –ó–∞–±–æ—Ç—ã", i: "üõå"}, {n: "–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –§–æ–Ω–∞—Ä–∏–∫", i: "üî¶"},
            {n: "–í–æ–ª—à–µ–±–Ω–æ–µ –°–µ—Ä–¥—Ü–µ", i: "üíñ"}, {n: "–õ–µ—Å –¢–∏—à–∏–Ω—ã", i: "üå≤"}, {n: "–í–æ–ª–Ω–∞ –†–∞–¥–æ—Å—Ç–∏", i: "üåä"},
            {n: "–°–≤–µ—Ç–ª—è—á–æ–∫ –ó–∞–±–æ—Ç—ã", i: "ü™î"}, {n: "–í–æ–ª—à–µ–±–Ω–æ–µ –£—Ö–æ", i: "üëÇ"}, {n: "–†–µ–∫–∞ –ü—Ä–∏–Ω—è—Ç–∏—è", i: "üö£"},
            {n: "–õ–∞–º–ø–æ—á–∫–∞ –û—Å–æ–∑–Ω–∞–Ω–∏—è", i: "üí°"}, {n: "–ö—Ä—ã–ª—å—è –ú–µ—á—Ç—ã", i: "ü™Ω"}, {n: "–ö—Ä–∏—Å—Ç–∞–ª–ª –ß–µ—Å—Ç–Ω–æ—Å—Ç–∏", i: "üíé"},
            {n: "–ó–æ–ª–æ—Ç–∞—è –ù–∏—Ç—å", i: "üßµ"}, {n: "–ó–≤–µ–∑–¥–∞ –ù–∞–¥–µ–∂–¥—ã", i: "‚≠ê"}, {n: "–í–æ–ª—à–µ–±–Ω—ã–π –ö–ª—é—á", i: "üîë"}
        ];

        let isScrolling = false;
        let scrollInterval;

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–µ—Ç–∫–∏
        const grid = document.getElementById('main-grid');
        items.forEach((item, i) => {
            const card = document.createElement('div');
            card.className = 'day-card';
            card.innerHTML = `<div style="font-size:9px; color:#aaa">–î–ï–ù–¨ ${i+1}</div><div class="day-icon">${item.i}</div><div class="day-name">${item.n}</div>`;
            card.onclick = () => openDay(i + 1, item.n);
            grid.appendChild(card);
        });

        // –§—É–Ω–∫—Ü–∏—è –≤—Å—Ç–∞–≤–∫–∏ –∫–∞—Ä—Ç–∏–Ω–æ–∫
        function formatStory(text, dayNum) {
            if (!text) return "";
            // –ò—â–µ—Ç [IMAGE] –∏ –∑–∞–º–µ–Ω—è–µ—Ç –Ω–∞ —Ç–µ–≥ –∫–∞—Ä—Ç–∏–Ω–∫–∏ images/dayX.jpg
            const imgTag = `<img src="images/day${dayNum}.jpg" class="book-illustration" onerror="this.style.display='none'">`;
            return text.replace("[IMAGE]", imgTag);
        }

        async function openDay(num, name) {
            const container = document.getElementById('scroll-box');
            container.scrollTop = 0;
            
            document.getElementById('title-label').innerText = name;
            const player = document.getElementById('audio-player');
            player.src = `audio/day${num}_story.mp3`;
            player.load();
            
            try {
                const res = await fetch(`texts/day${num}.json`);
                const data = await res.json();
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç –∏—Å—Ç–æ—Ä–∏–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∫–∞—Ä—Ç–∏–Ω–æ–∫
                document.getElementById('story-display').innerHTML = formatStory(data.story, num);
                document.getElementById('practice-display').innerText = data.child + "\n\n---\n\n" + data.adult;
            } catch (e) {
                document.getElementById('story-display').innerText = "–ò—Å—Ç–æ—Ä–∏—è —Å–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è...";
                document.getElementById('practice-display').innerText = "";
            }

            document.getElementById('content-page').style.display = 'block';
            document.getElementById('main-view').style.display = 'none';
        }

        function toggleAutoScroll() {
            const container = document.getElementById('scroll-box');
            const btn = document.getElementById('scroll-btn');
            
            if (isScrolling) {
                clearInterval(scrollInterval);
                btn.innerText = "‚ú® –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å";
                btn.classList.remove('active');
            } else {
                scrollInterval = setInterval(() => {
                    container.scrollTop += 1; 
                    if (container.scrollTop + container.clientHeight >= container.scrollHeight - 10) {
                        stopScroll();
                    }
                }, 40); 
                btn.innerText = "‚è∏ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å";
                btn.classList.add('active');
            }
            isScrolling = !isScrolling;
        }

        function stopScroll() {
            clearInterval(scrollInterval);
            isScrolling = false;
            document.getElementById('scroll-btn').innerText = "‚ú® –í –Ω–∞—á–∞–ª–æ";
            document.getElementById('scroll-btn').classList.remove('active');
        }

        function closeDay() {
            // –û–°–¢–ê–ù–û–í–ö–ê –í–°–ï–ì–û
            clearInterval(scrollInterval);
            isScrolling = false;
            
            const player = document.getElementById('audio-player');
            player.pause();
            player.src = ""; 

            // –°–ë–†–û–° –ö–ù–û–ü–ö–ò
            const btn = document.getElementById('scroll-btn');
            btn.innerText = "‚ú® –ù–∞—á–∞—Ç—å —á—Ç–µ–Ω–∏–µ";
            btn.classList.remove('active');

            // –û–ß–ò–°–¢–ö–ê –ö–û–ù–¢–ï–ù–¢–ê
            document.getElementById('story-display').innerHTML = "";
            document.getElementById('practice-display').innerText = "";

            // –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –≠–ö–†–ê–ù–ê
            document.getElementById('content-page').style.display = 'none';
            document.getElementById('main-view').style.display = 'block';
        }

        const tg = window.Telegram.WebApp;
        tg.ready(); tg.expand();
    </script>
</body>
</html>
