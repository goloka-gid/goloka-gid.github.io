<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ú–∏—Ä –≠–ª–ª–∏</title>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&family=Lora:ital,wght@0,400;1,500&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Å–±—Ä–æ—Å –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ —à–∏—Ä–∏–Ω—ã */
        * { box-sizing: border-box; }

        :root {
            --bg-gradient: linear-gradient(135deg, #FFF5E1 0%, #E6E6FA 50%, #E0F7FA 100%);
            --accent: #8A2BE2;
            --text-color: #483D8B;
            --gold: #FFD700;
        }

        body {
            font-family: 'Comfortaa', cursive;
            background: var(--bg-gradient);
            background-attachment: fixed;
            color: var(--text-color);
            margin: 0; 
            padding: 10px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –æ—Ç—Å—Ç—É–ø, —á—Ç–æ–±—ã –≤–ª–µ–∑–ª–æ 3 –∫–æ–ª–æ–Ω–∫–∏ */
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-3px); }
            100% { transform: translateY(0px); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #main-view { display: block; animation: fadeIn 0.8s ease-out; }
        
        h1 {
            text-shadow: 2px 2px 0px rgba(255,255,255,0.8);
            font-size: 24px; margin: 15px 0 20px 0;
        }

        /* –°–µ—Ç–∫–∞ –î–Ω–µ–π: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ */
        .grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 8px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –∑–∞–∑–æ—Ä –º–µ–∂–¥—É –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ */
            max-width: 500px; 
            margin: 0 auto; 
            padding-bottom: 50px; 
        }
        
        .day-card {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border-radius: 16px; /* –ß—É—Ç—å –º–µ–Ω—å—à–µ —Ä–∞–¥–∏—É—Å –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏ */
            padding: 10px 2px; /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –≤–Ω—É—Ç—Ä–∏ */
            text-align: center;
            box-shadow: 0 4px 10px rgba(138, 43, 226, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.8); 
            transition: all 0.2s;
            position: relative; cursor: pointer;
            
            /* –ß—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –Ω–µ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–ª –∫–∞—Ä—Ç–æ—á–∫—É */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-width: 0; /* –í–∞–∂–Ω–æ –¥–ª—è Grid! */
        }
        .day-card:active { transform: scale(0.95); }
        
        .day-card.completed {
            border-color: var(--gold);
            background: rgba(255, 248, 220, 0.8);
        }
        .day-card.completed::after {
            content: '‚≠ê'; position: absolute; top: -6px; right: -6px;
            font-size: 14px; animation: float 3s infinite ease-in-out;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.1));
            z-index: 2;
        }

        .day-icon { font-size: 28px; margin: 4px 0; filter: drop-shadow(0 4px 2px rgba(0,0,0,0.1)); }
        
        .day-name { 
            font-size: 10px; 
            font-weight: bold; 
            line-height: 1.1; 
            width: 100%;
            word-wrap: break-word; /* –ü–µ—Ä–µ–Ω–æ—Å –¥–ª–∏–Ω–Ω—ã—Ö —Å–ª–æ–≤ */
            overflow-wrap: break-word;
            padding: 0 2px;
        }

        /* –≠–∫—Ä–∞–Ω —á—Ç–µ–Ω–∏—è */
        #content-page {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-gradient); z-index: 1000;
        }

        .header-fixed {
            position: absolute; top: 0; left: 0; width: 100%; height: 70px;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 15px; box-sizing: border-box;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(15px);
            z-index: 1100;
            border-bottom: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 5px 20px rgba(138, 43, 226, 0.05);
        }

        .scroll-wrapper {
            position: relative; height: 100%; padding-top: 70px;
            mask-image: linear-gradient(to bottom, transparent, black 5%, black 95%, transparent);
            -webkit-mask-image: linear-gradient(to bottom, transparent, black 5%, black 95%, transparent);
        }

        .scroll-container {
            height: 100%; overflow-y: auto; scroll-behavior: smooth;
            padding: 15px 15px 200px 15px; box-sizing: border-box;
        }

        .magic-scroll-btn {
            background: linear-gradient(45deg, #9b87f5, #8A2BE2);
            border: none; padding: 10px 18px;
            border-radius: 50px; color: white; font-weight: bold;
            box-shadow: 0 4px 15px rgba(138, 43, 226, 0.4);
            font-family: 'Comfortaa'; cursor: pointer; font-size: 13px; transition: 0.3s;
        }
        .magic-scroll-btn:active { transform: scale(0.95); opacity: 0.9; }
        .magic-scroll-btn.active { background: #ff6b6b; box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4); }

        .magic-text {
            font-family: 'Lora', serif;
            font-size: 18px; line-height: 1.7; color: #3a2b5d;
            text-shadow: 0.5px 0.5px 0px rgba(255,255,255,0.8);
            white-space: pre-wrap; margin: 10px 0;
        }

        .section-box {
            background: rgba(255,255,255,0.5);
            border-radius: 24px; padding: 20px 15px; margin-bottom: 20px;
            border: 2px solid white;
            box-shadow: 0 10px 30px rgba(138, 43, 226, 0.05);
            animation: fadeIn 0.5s ease-out;
        }

        .back-btn { 
            background: white; border: none; width: 40px; height: 40px; border-radius: 50%; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1); font-size: 20px; cursor: pointer; 
            color: var(--accent); transition: 0.2s;
            display: flex; align-items: center; justify-content: center;
        }
        .back-btn:active { transform: scale(0.9); }

        /* –ú–µ–¥–∏–∞ */
        .book-media {
            width: 100%; max-width: 100%; display: block;
            margin: 20px auto; border-radius: 16px;
            box-shadow: 0 8px 20px rgba(138, 43, 226, 0.15);
            border: 4px solid white;
        }
        
        .video-container {
            position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;
            border-radius: 16px; border: 4px solid white;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            background: black; margin-top: 15px; display: none;
        }
        .video-container video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        audio { filter: drop-shadow(0 4px 4px rgba(0,0,0,0.05)); border-radius: 30px; width: 100%; }
    </style>
</head>
<body>

    <div id="main-view">
        <h1 style="text-align: center; color: var(--accent);">‚ú® –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≠–ª–ª–∏</h1>
        <div class="grid" id="main-grid"></div>
    </div>

    <div id="content-page">
        <div class="header-fixed">
            <button class="back-btn" onclick="closeDay()">üîô</button>
            <button class="magic-scroll-btn" id="scroll-btn" onclick="toggleAutoScroll()">‚ú® –ß–∏—Ç–∞—Ç—å</button>
        </div>

        <div class="scroll-wrapper">
            <div class="scroll-container" id="scroll-box">
                <h2 id="title-label" style="text-align: center; color: var(--accent); margin-bottom: 15px;"></h2>

                <div class="section-box" id="video-box" style="display:none; text-align:center;">
                    <h3 style="color: var(--accent); margin-top:0; font-size: 16px;">üé¨ –í–æ–ª—à–µ–±–Ω–æ–µ –≤–∏–¥–µ–æ</h3>
                    <div class="video-container" id="video-wrapper">
                        <video id="video-player" controls playsinline></video>
                    </div>
                </div>

                <div class="section-box">
                    <div id="story-display" class="magic-text"></div>
                </div>

                <div class="section-box">
                    <h3 style="color: var(--accent); margin-top:0; font-size: 16px;">üéµ –°–ª—É—à–∞—Ç—å —Å–∫–∞–∑–∫—É</h3>
                    <audio id="audio-player" controls></audio>
                </div>
                
                <div class="section-box">
                    <h3 style="color: var(--accent); margin-top:0; font-size: 16px;">üßò –ü—Ä–∞–∫—Ç–∏–∫–∞ –¥–Ω—è</h3>
                    <div id="practice-display" class="magic-text" style="font-size: 16px;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const items = [
            {n: "–í–æ–ª—à–µ–±–Ω–∞—è –ö–∏—Å—Ç—å", i: "üñåÔ∏è"}, {n: "–ó–µ—Ä–∫–∞–ª–æ –ú–µ—á—Ç—ã", i: "ü™û"}, {n: "–ö–æ–º–ø–∞—Å –ù–∞–º–µ—Ä–µ–Ω–∏–π", i: "üß≠"},
            {n: "–°—É–Ω–¥—É–∫ –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–µ–π", i: "üì¶"}, {n: "–ê–º—É–ª–µ—Ç –°–∏–ª—ã", i: "üßø"}, {n: "–í–æ–ª—à–µ–±–Ω—ã–π –ü–æ—è—Å", i: "üéóÔ∏è"},
            {n: "–©–∏—Ç –ù–∞—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏", i: "üõ°Ô∏è"}, {n: "–ú–æ—Å—Ç –†–∞–¥–æ—Å—Ç–∏", i: "üåà"}, {n: "–õ–æ–≤–µ—Ü –ú—ã—Å–ª–µ–π", i: "üï∏Ô∏è"},
            {n: "–í–æ–ª—à–µ–±–Ω–∞—è –ö–Ω–æ–ø–∫–∞", i: "üîò"}, {n: "–†—é–∫–∑–∞–∫ –ü–æ–¥–¥–µ—Ä–∂–∫–∏", i: "üéí"}, {n: "–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –°–∞–¥", i: "üå≥"},
            {n: "–°–≤–µ—Ç–æ—Ñ–æ—Ä –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏—è", i: "üö•"}, {n: "–î–æ–º–∏–∫ –°–ø–æ–∫–æ–π—Å—Ç–≤–∏—è", i: "üè†"}, {n: "–í–æ–ª—à–µ–±–Ω—ã–π –®–∞–≥", i: "üë£"},
            {n: "–í–æ–ª—à–µ–±–Ω—ã–µ –û—á–∫–∏", i: "üëì"}, {n: "–û–¥–µ—è–ª–æ –ó–∞–±–æ—Ç—ã", i: "üõå"}, {n: "–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –§–æ–Ω–∞—Ä–∏–∫", i: "üî¶"},
            {n: "–í–æ–ª—à–µ–±–Ω–æ–µ –°–µ—Ä–¥—Ü–µ", i: "üíñ"}, {n: "–õ–µ—Å –¢–∏—à–∏–Ω—ã", i: "üå≤"}, {n: "–í–æ–ª–Ω–∞ –†–∞–¥–æ—Å—Ç–∏", i: "üåä"},
            {n: "–°–≤–µ—Ç–ª—è—á–æ–∫ –ó–∞–±–æ—Ç—ã", i: "ü™î"}, {n: "–í–æ–ª—à–µ–±–Ω–æ–µ –£—Ö–æ", i: "üëÇ"}, {n: "–†–µ–∫–∞ –ü—Ä–∏–Ω—è—Ç–∏—è", i: "üö£"},
            {n: "–õ–∞–º–ø–æ—á–∫–∞ –û—Å–æ–∑–Ω–∞–Ω–∏—è", i: "üí°"}, {n: "–ö—Ä—ã–ª—å—è –ú–µ—á—Ç—ã", i: "ü™Ω"}, {n: "–ö—Ä–∏—Å—Ç–∞–ª–ª –ß–µ—Å—Ç–Ω–æ—Å—Ç–∏", i: "üíé"},
            {n: "–ó–æ–ª–æ—Ç–∞—è –ù–∏—Ç—å", i: "üßµ"}, {n: "–ó–≤–µ–∑–¥–∞ –ù–∞–¥–µ–∂–¥—ã", i: "‚≠ê"}, {n: "–í–æ–ª—à–µ–±–Ω—ã–π –ö–ª—é—á", i: "üîë"}
        ];

        let isScrolling = false;
        let scrollInterval;
        let readDays = JSON.parse(localStorage.getItem('elli_progress')) || [];

        function renderGrid() {
            const grid = document.getElementById('main-grid');
            grid.innerHTML = '';
            items.forEach((item, i) => {
                const dayNum = i + 1;
                const card = document.createElement('div');
                const isRead = readDays.includes(dayNum);
                card.className = `day-card ${isRead ? 'completed' : ''}`;
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º flex –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –∏ word-wrap –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞
                card.innerHTML = `
                    <div style="font-size:9px; color: ${isRead ? '#d4af37' : '#aaa'}; font-weight:${isRead?'bold':'normal'}; margin-bottom:2px;">–î–ï–ù–¨ ${dayNum}</div>
                    <div class="day-icon">${item.i}</div>
                    <div class="day-name">${item.n}</div>
                `;
                card.onclick = () => openDay(dayNum, item.n);
                grid.appendChild(card);
            });
        }
        
        renderGrid();

        // --- –õ–û–ì–ò–ö–ê –ö–û–ù–¢–ï–ù–¢–ê ---
        function formatStory(text, dayNum) {
            if (!text) return "";
            
            // –ö–∞—Ä—Ç–∏–Ω–∫–∏ [IMAGE] –∏ [IMAGE1]...
            let html = text.replace(/\[IMAGE(\d*)\]/g, (match, p1) => {
                const suffix = p1 ? `_${p1}` : ''; 
                return `<img src="images/day${dayNum}${suffix}.jpg" class="book-media" alt="–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è" onerror="this.style.display='none'">`;
            });

            // –ì–∏—Ñ–∫–∏ [GIF] –∏ [GIF1]...
            html = html.replace(/\[GIF(\d*)\]/g, (match, p1) => {
                const suffix = p1 ? `_${p1}` : '';
                return `<img src="images/day${dayNum}${suffix}.gif" class="book-media" alt="–ê–Ω–∏–º–∞—Ü–∏—è" onerror="this.style.display='none'">`;
            });
            
            return html;
        }

        async function openDay(num, name) {
            const container = document.getElementById('scroll-box');
            container.scrollTop = 0;
            
            if (!readDays.includes(num)) {
                readDays.push(num);
                localStorage.setItem('elli_progress', JSON.stringify(readDays));
                renderGrid(); 
            }

            document.getElementById('title-label').innerText = name;
            
            const audioPlayer = document.getElementById('audio-player');
            audioPlayer.src = `audio/day${num}_story.mp3`;
            audioPlayer.load();

            const videoBox = document.getElementById('video-box');
            const videoWrapper = document.getElementById('video-wrapper');
            const videoPlayer = document.getElementById('video-player');
            
            videoBox.style.display = 'none';
            videoPlayer.src = "";

            try {
                const res = await fetch(`texts/day${num}.json`); 
                if (!res.ok) throw new Error("–ù–µ—Ç —Ñ–∞–π–ª–∞");
                const data = await res.json();
                
                document.getElementById('story-display').innerHTML = formatStory(data.story, num);
                document.getElementById('practice-display').innerText = (data.child || "") + "\n\n---\n\n" + (data.adult || "");

                if (data.video) {
                    videoBox.style.display = 'block';
                    videoWrapper.style.display = 'block';
                    videoPlayer.src = `videos/day${num}.mp4`;
                }

            } catch (e) {
                console.error(e);
                document.getElementById('story-display').innerText = "–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫–∞ –ø–∏—à–µ—Ç—Å—è –≤–æ–ª—à–µ–±–Ω–∏–∫–∞–º–∏...";
                document.getElementById('practice-display').innerText = "";
            }

            document.getElementById('content-page').style.display = 'block';
            document.getElementById('main-view').style.display = 'none';
        }

        function toggleAutoScroll() {
            const container = document.getElementById('scroll-box');
            const btn = document.getElementById('scroll-btn');
            
            if (isScrolling) {
                clearInterval(scrollInterval);
                btn.innerText = "‚ú® –ß–∏—Ç–∞—Ç—å";
                btn.classList.remove('active');
            } else {
                scrollInterval = setInterval(() => {
                    container.scrollTop += 1; 
                    if (container.scrollTop + container.clientHeight >= container.scrollHeight - 5) {
                        stopScroll();
                    }
                }, 30);
                btn.innerText = "‚è∏ –ü–∞—É–∑–∞";
                btn.classList.add('active');
            }
            isScrolling = !isScrolling;
        }

        function stopScroll() {
            clearInterval(scrollInterval);
            isScrolling = false;
            document.getElementById('scroll-btn').innerText = "‚ú® –í –Ω–∞—á–∞–ª–æ";
            document.getElementById('scroll-btn').classList.remove('active');
        }

        function closeDay() {
            clearInterval(scrollInterval);
            isScrolling = false;
            
            const audio = document.getElementById('audio-player');
            audio.pause(); 
            const video = document.getElementById('video-player');
            video.pause();

            document.getElementById('scroll-btn').innerText = "‚ú® –ß–∏—Ç–∞—Ç—å";
            document.getElementById('scroll-btn').classList.remove('active');

            document.getElementById('content-page').style.display = 'none';
            document.getElementById('main-view').style.display = 'block';
        }

        const tg = window.Telegram.WebApp;
        tg.ready(); tg.expand();
        tg.setHeaderColor('#fdfbf7'); 
        tg.setBackgroundColor('#fdfbf7');
    </script>
</body>
</html>
